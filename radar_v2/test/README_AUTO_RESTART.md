# ìë™ ì¬ì‹œì‘ ëª¨ë“œ - ì‚¬ìš© ê°€ì´ë“œ

## ëª©ì 

30ë¶„ë§ˆë‹¤ í”„ë¡œê·¸ë¨ì„ ìë™ìœ¼ë¡œ ì¬ì‹œì‘í•˜ì—¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

## ì‘ë™ ì›ë¦¬

```
[ì„¸ì…˜ 1] 30ë¶„ ì‹¤í–‰ â†’ ë©”ëª¨ë¦¬ 8.5GB ë„ë‹¬ â†’ ì¢…ë£Œ
         â†“ (5ì´ˆ ëŒ€ê¸°)
[ì„¸ì…˜ 2] ì¬ì‹œì‘ â†’ ë©”ëª¨ë¦¬ 140MBë¡œ ë¦¬ì…‹ â†’ 30ë¶„ ì‹¤í–‰
         â†“ (5ì´ˆ ëŒ€ê¸°)
[ì„¸ì…˜ 3] ë°˜ë³µ...
```

**íš¨ê³¼:**
- ë©”ëª¨ë¦¬ ìµœëŒ€ê°’: 8.5GB (ê³ ì •)
- OOM ë°œìƒ: ì—†ìŒ
- ë¬´í•œ ì‹¤í–‰ ê°€ëŠ¥

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬

```bash
cd /mnt/e/work/withclaude/radar_data/sensr_lidar_recorder/test
chmod +x auto_restart.sh
```

### 2. ì‹¤í–‰

```bash
./auto_restart.sh
```

### 3. ì¤‘ì§€

```
Ctrl + C
```

---

## âš™ï¸ ì„¤ì • ë³€ê²½

`auto_restart.sh` íŒŒì¼ì„ í¸ì§‘:

```bash
nano auto_restart.sh
```

**ì£¼ìš” ì„¤ì •:**

```bash
DURATION=1800        # ì„¸ì…˜ ì‹œê°„ (ì´ˆ)
                     # 1800 = 30ë¶„
                     # 3600 = 1ì‹œê°„

HOST="samyang"       # SENSR í˜¸ìŠ¤íŠ¸ ID
                     # kimnyeong, samyang ë“±

RESTART_DELAY=5      # ì¬ì‹œì‘ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)
```

---

## ğŸ“Š ì¶œë ¥ ì˜ˆì‹œ

```
=======================================================================
ğŸš€ SENSR LiDAR Recorder - ìë™ ì¬ì‹œì‘ ëª¨ë“œ
=======================================================================
í˜¸ìŠ¤íŠ¸: samyang
ì„¸ì…˜ ì‹œê°„: 1800ì´ˆ (30ë¶„)
ì¬ì‹œì‘ ëŒ€ê¸°: 5ì´ˆ
=======================================================================

=======================================================================
ğŸš€ ì„¸ì…˜ 1 ì‹œì‘: 2025-11-07 13:00:00
=======================================================================

[ë©”ì¸ í”„ë¡œê·¸ë¨ ë¡œê·¸...]

=======================================================================
ğŸ”„ ì„¸ì…˜ 1 ì¢…ë£Œ: 2025-11-07 13:30:00
   ì¢…ë£Œ ì½”ë“œ: 124
   ì´ìœ : ì •ìƒ íƒ€ì„ì•„ì›ƒ (1800ì´ˆ)
   5ì´ˆ í›„ ì¬ì‹œì‘...
=======================================================================

=======================================================================
ğŸš€ ì„¸ì…˜ 2 ì‹œì‘: 2025-11-07 13:30:05
=======================================================================

[ë°˜ë³µ...]
```

---

## ğŸ“ˆ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§

**ë³„ë„ í„°ë¯¸ë„ì—ì„œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§:**

```bash
watch -n 5 'ps aux | grep main_optimized.py | grep -v grep | awk "{printf \"ë©”ëª¨ë¦¬: %.1f MB\\n\", \$6/1024}"'
```

**ì˜ˆìƒ íŒ¨í„´:**
```
13:00 - ë©”ëª¨ë¦¬: 140 MB
13:15 - ë©”ëª¨ë¦¬: 4500 MB
13:29 - ë©”ëª¨ë¦¬: 8500 MB
13:30 - ì¬ì‹œì‘
13:30 - ë©”ëª¨ë¦¬: 140 MB  â† ì´ˆê¸°í™”!
13:45 - ë©”ëª¨ë¦¬: 4500 MB
...
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„° ì†ì‹¤

**ì¬ì‹œì‘ ì‹œ 5~10ì´ˆ ë°ì´í„° ì†ì‹¤ ë°œìƒ**

- ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ì‹œê°„
- ROS2 ì´ˆê¸°í™” ì‹œê°„
- Bag íŒŒì¼ ìƒì„± ì‹œê°„

**ê¶Œì¥:**
- ì¤‘ìš”í•œ ì´ë²¤íŠ¸ê°€ ì—†ëŠ” ì‹œê°„ëŒ€ì— ì¬ì‹œì‘
- ë˜ëŠ” Durationì„ 1ì‹œê°„ìœ¼ë¡œ ëŠ˜ë ¤ì„œ ì¬ì‹œì‘ ë¹ˆë„ ê°ì†Œ

### 2. Bag íŒŒì¼ ë¶„ë¦¬

**30ë¶„ë§ˆë‹¤ ìƒˆ Bag íŒŒì¼ ìƒì„±**

ì˜ˆì‹œ:
```
sensr_data_20251107_130000/
sensr_data_20251107_133005/
sensr_data_20251107_140010/
...
```

**ë¶„ì„ ì‹œ:**
```bash
# ì—¬ëŸ¬ íŒŒì¼ ìˆœì°¨ ì¬ìƒ
ros2 bag play sensr_data_*
```

### 3. ë¡œê·¸ íŒŒì¼ í¬ê¸°

**ë¡œê·¸ê°€ ê³„ì† ìŒ“ì´ë¯€ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ì •ë¦¬ í•„ìš”**

```bash
# ë¡œê·¸ ë¡œí…Œì´ì…˜
cd logs
mv sensr_recorder.log sensr_recorder_$(date +%Y%m%d_%H%M%S).log
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### 1ì‹œê°„ í…ŒìŠ¤íŠ¸ (ì„¸ì…˜ 2íšŒ)

```bash
# í„°ë¯¸ë„ 1: í”„ë¡œê·¸ë¨ ì‹¤í–‰
./auto_restart.sh

# í„°ë¯¸ë„ 2: ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§
watch -n 5 'ps aux | grep main_optimized | grep -v grep'

# í„°ë¯¸ë„ 3: ë¡œê·¸ í™•ì¸
tail -f logs/sensr_recorder.log
```

**í™•ì¸ ì‚¬í•­:**
- [ ] 30ë¶„ í›„ í”„ë¡œê·¸ë¨ ìë™ ì¬ì‹œì‘
- [ ] ì¬ì‹œì‘ í›„ ë©”ëª¨ë¦¬ 140MBë¡œ ì´ˆê¸°í™”
- [ ] Bag íŒŒì¼ 2ê°œ ìƒì„± (30ë¶„ + 30ë¶„)
- [ ] ë°ì´í„° ìˆ˜ì‹  ì •ìƒ
- [ ] OOM ì—†ìŒ

---

## ğŸ¯ ì¥ê¸° ìš´ì˜ (24ì‹œê°„+)

### systemd ì„œë¹„ìŠ¤ë¡œ ë“±ë¡ (ì„ íƒì‚¬í•­)

ë¬´í•œ ì¬ì‹œì‘, ë¶€íŒ… ì‹œ ìë™ ì‹œì‘:

```bash
# ì„œë¹„ìŠ¤ íŒŒì¼ ìƒì„±
sudo nano /etc/systemd/system/sensr-recorder.service
```

```ini
[Unit]
Description=SENSR LiDAR Recorder (Auto Restart)
After=network.target

[Service]
Type=simple
User=yjs95
WorkingDirectory=/mnt/e/work/withclaude/radar_data/sensr_lidar_recorder/test
ExecStart=/bin/bash auto_restart.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# ì„œë¹„ìŠ¤ í™œì„±í™”
sudo systemctl daemon-reload
sudo systemctl enable sensr-recorder
sudo systemctl start sensr-recorder

# ìƒíƒœ í™•ì¸
sudo systemctl status sensr-recorder

# ë¡œê·¸ í™•ì¸
sudo journalctl -u sensr-recorder -f
```

---

## ğŸ“‹ ë¹„êµ: ê¸°ì¡´ vs ìë™ ì¬ì‹œì‘

| í•­ëª© | ê¸°ì¡´ (Test 5) | ìë™ ì¬ì‹œì‘ | ê°œì„  |
|------|--------------|------------|------|
| **30ë¶„ ë©”ëª¨ë¦¬** | 8,507 MB | 8,507 MB | ë™ì¼ |
| **1ì‹œê°„ ë©”ëª¨ë¦¬** | ~17,000 MB (OOM ìœ„í—˜) | **8,507 MB** | âœ… ì•ˆì • |
| **ë¬´í•œ ì‹¤í–‰** | ë¶ˆê°€ëŠ¥ | **ê°€ëŠ¥** | âœ… |
| **ì½”ë“œ ë³€ê²½** | ë§ìŒ | **ì—†ìŒ** | âœ… |
| **ë°ì´í„° ì†ì‹¤** | ì—†ìŒ | 5~10ì´ˆ/30ë¶„ | âš ï¸ |

---

## ğŸ” ë¬¸ì œ í•´ê²°

### í”„ë¡œê·¸ë¨ì´ ì¬ì‹œì‘ ì•ˆ ë¨

**ì¦ìƒ:** 30ë¶„ í›„ì—ë„ ê³„ì† ì‹¤í–‰

**ì›ì¸:** `timeout` ëª…ë ¹ì–´ ì—†ìŒ

**í•´ê²°:**
```bash
# timeout ì„¤ì¹˜
sudo apt-get install coreutils
```

### Permission denied ì˜¤ë¥˜

**í•´ê²°:**
```bash
chmod +x auto_restart.sh
```

### ë©”ëª¨ë¦¬ê°€ ê³„ì† ì¦ê°€

**ì¦ìƒ:** ì¬ì‹œì‘í•´ë„ ë©”ëª¨ë¦¬ 140MBë¡œ ì•ˆ ëŒì•„ê°

**ì›ì¸:** í”„ë¡œì„¸ìŠ¤ê°€ ì œëŒ€ë¡œ ì¢…ë£Œ ì•ˆ ë¨

**í™•ì¸:**
```bash
ps aux | grep python
# ë‚¨ì•„ìˆëŠ” í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ
killall python
```

---

## ğŸ“ ë¡œê·¸ ë¶„ì„

### ì„¸ì…˜ë³„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¶”ì¶œ

```bash
grep "ìµœì¢… í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸" logs/sensr_recorder.log -A 20 | grep "ë©”ëª¨ë¦¬ (ìµœëŒ€)"
```

### ì¬ì‹œì‘ íšŸìˆ˜ í™•ì¸

```bash
grep "ì„¸ì…˜.*ì‹œì‘" auto_restart.log | wc -l
```

---

**ì‘ì„±ì¼**: 2025-11-07
**ëª©ì **: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìš°íšŒ (30ë¶„ ì¬ì‹œì‘)
**ì˜ˆìƒ íš¨ê³¼**: ë¬´í•œ ì‹¤í–‰ ê°€ëŠ¥, OOM ë°©ì§€
